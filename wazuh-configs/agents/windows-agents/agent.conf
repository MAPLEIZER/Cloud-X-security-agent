<!-- Shared agent configuration for Windows -->
<agent_config os="windows">

  <!-- Policy monitoring -->
  <rootcheck>
    <disabled>no</disabled>
    <check_files>yes</check_files>
    <check_trojans>yes</check_trojans>
    <check_dev>yes</check_dev>
    <check_sys>yes</check_sys>
    <check_pids>yes</check_pids>
    <check_ports>yes</check_ports>
    <check_if>yes</check_if>
    <frequency>21600</frequency>
  </rootcheck>

  <wodle name="syscollector">
    <disabled>no</disabled>
    <interval>1h</interval>
    <scan_on_start>yes</scan_on_start>
    <hardware>yes</hardware>
    <os>yes</os>
    <packages>yes</packages>
    <ports all="yes">yes</ports>
    <processes>yes</processes>
  </wodle>

  <command>
    <name>disable-account</name>
    <executable>disable-account.cmd</executable>
    <timeout_allowed>yes</timeout_allowed>
  </command>

  <command>
    <name>firewall-drop</name>
    <executable>firewall-drop.cmd</executable>
    <timeout_allowed>yes</timeout_allowed>
  </command>

  <active-response>
    <disabled>no</disabled>
    <command>disable-account</command>
    <location>local</location>
  </active-response>

  <active-response>
    <disabled>no</disabled>
    <command>firewall-drop</command>
    <location>local</location>
  </active-response>

  <syscheck>
    <disabled>no</disabled>

    <!-- Directories to check in real-time -->
    <directories realtime="yes" report_changes="yes">C:\Windows\System32</directories>
    <directories realtime="yes" report_changes="yes">C:\Windows\SysWOW64</directories>
    <directories realtime="yes" report_changes="yes">C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</directories>
    <directories realtime="yes" report_changes="yes">C:\Users\*\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</directories>

    <!-- Directories to check periodically -->
    <directories check_all="yes">C:\Program Files</directories>
    <directories check_all="yes">C:\Program Files (x86)</directories>
    <directories check_all="yes">C:\Users\*\Documents</directories>

    <!-- Registry entries to monitor -->
    <registry_entries realtime="yes">
      <entry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</entry>
      <entry>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</entry>
    </registry_entries>

    <!-- Files to ignore -->
    <ignore>C:\Windows\System32\config</ignore>
    <ignore>C:\Windows\System32\LogFiles</ignore>
    <ignore>C:\Windows\System32\wbem\Repository</ignore>
    <ignore>.log$</ignore>
    <ignore>.tmp$</ignore>
  </syscheck>

  <command>
    <name>remove-threat</name>
    <executable>remove-threat.py</executable>
    <expect>alert_json</expect>
    <timeout_allowed>yes</timeout_allowed>
  </command>

  <active-response>
    <command>remove-threat</command>
    <location>local</location>
    <rules_group>virustotal,</rules_group>
    <level>12</level>
  </active-response>

</agent_config>
